<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Persistent Color Button Rows</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .controls {
            margin-bottom: 10px;
        }
        .buttons {
            display: flex;
            margin-bottom: 5px;
        }
        .button, .control-button {
            width: 1cm;
            height: 1cm;
            margin: 0 1px;
            border: 1px solid #ccc;
            cursor: pointer;
            display: inline-block;
        }
        .control-button {
            width: auto;
            padding: 0 10px;
            background-color: #4285f4;
            color: white;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button class="control-button" id="addRow">Add Row</button>
        <button class="control-button" id="removeRow">Remove Row</button>
    </div>
    <div id="buttonContainer"></div>

    <script>
        const colors = ['#ffffff', '#4285f4', '#0f9d58', '#f4b400', '#db4437'];

        function createButton(row, index) {
            const button = document.createElement('div');
            button.className = 'button';

            // Unique key for each button based on its row and column index
            const buttonKey = `button-${row}-${index}`;
            const count = Number(localStorage.getItem(buttonKey)) || 0;
            updateButtonColor(button, count);

            button.addEventListener('click', () => {
                let newCount = (Number(localStorage.getItem(buttonKey)) + 1) % colors.length;
                localStorage.setItem(buttonKey, newCount);
                updateButtonColor(button, newCount);
            });

            return button;
        }

        function updateButtonColor(button, count) {
            button.style.backgroundColor = colors[count];
        }

        function addRow() {
            const rowCount = document.getElementById('buttonContainer').childElementCount;
            const buttonRow = document.createElement('div');
            buttonRow.className = 'buttons';

            for (let i = 0; i < 5; i++) {
                const button = createButton(rowCount, i);
                buttonRow.appendChild(button);
            }

            document.getElementById('buttonContainer').appendChild(buttonRow);
            saveRowCount(rowCount + 1);
        }

        function removeRow() {
            const container = document.getElementById('buttonContainer');
            const rowCount = container.childElementCount;
            if (rowCount > 0) {
                for (let i = 0; i < 5; i++) {
                    localStorage.removeItem(`button-${rowCount - 1}-${i}`);
                }
                container.removeChild(container.lastChild);
                saveRowCount(rowCount - 1);
            }
        }

        function saveRowCount(count) {
            localStorage.setItem('rowCount', count);
        }

        function loadRows() {
            const rowCount = Number(localStorage.getItem('rowCount')) || 0;
            for (let row = 0; row < rowCount; row++) {
                addRow();
            }
        }

        // Initialize functional buttons
        document.getElementById('addRow').addEventListener('click', addRow);
        document.getElementById('removeRow').addEventListener('click', removeRow);

        // Load existing rows on page load
        loadRows();
    </script>
</body>
</html>
